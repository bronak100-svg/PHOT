<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>אלבומי התמונות שלי - Google Drive</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;700;900&family=Rubik:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google API -->
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://accounts.google.com/gsi/client"></script>

    <style>
        * {
            font-family: 'Heebo', 'Rubik', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .glass {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .album-card {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .album-card:hover {
            transform: translateY(-10px) scale(1.02);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }
        
        .photo-container {
            position: relative;
            overflow: hidden;
            border-radius: 16px;
            transition: all 0.3s ease;
        }
        
        .photo-container:hover {
            transform: scale(1.03);
        }
        
        .caption-bubble {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 24px;
            border-radius: 30px;
            font-size: 14px;
            font-weight: 500;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            opacity: 0;
            transition: all 0.3s ease;
            max-width: 90%;
            text-align: center;
            z-index: 10;
        }
        
        .caption-bubble::before {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-top: 10px solid #764ba2;
        }
        
        .photo-container:hover .caption-bubble,
        .caption-bubble.visible {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }
        
        .floating-input {
            transition: all 0.3s ease;
        }
        
        .floating-input:focus {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        }
        
        .gradient-text {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .upload-zone {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
            border: 3px dashed rgba(102, 126, 234, 0.3);
            transition: all 0.3s ease;
        }
        
        .upload-zone:hover {
            border-color: #667eea;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.2) 0%, rgba(118, 75, 162, 0.2) 100%);
        }
        
        .modal-enter {
            animation: modalSlide 0.3s ease;
        }
        
        @keyframes modalSlide {
            from {
                opacity: 0;
                transform: scale(0.9) translateY(20px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }
        
        .photo-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 24px;
        }
        
        @media (max-width: 768px) {
            .photo-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .loading-spinner {
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top: 3px solid white;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .delete-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(239, 68, 68, 0.9);
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: all 0.3s ease;
            cursor: pointer;
            z-index: 20;
        }
        
        .photo-container:hover .delete-btn {
            opacity: 1;
        }
        
        .delete-btn:hover {
            transform: scale(1.1);
            background: rgba(239, 68, 68, 1);
        }
    </style>
</head>
<body class="text-gray-800">

    <!-- Header -->
    <header class="glass sticky top-0 z-50 px-6 py-4">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <div class="flex items-center gap-4">
                <div class="w-12 h-12 bg-gradient-to-br from-purple-500 to-blue-500 rounded-xl flex items-center justify-center text-white text-2xl shadow-lg">
                    <i class="fas fa-images"></i>
                </div>
                <div>
                    <h1 class="text-2xl font-bold text-white">PhotoCloud</h1>
                    <p class="text-white/70 text-sm">אלבומי התמונות שלך בענן</p>
                </div>
            </div>
            
            <div class="flex items-center gap-4">
                <button id="connectDriveBtn" onclick="handleAuthClick()" class="bg-white text-purple-600 px-6 py-2 rounded-full font-bold hover:shadow-lg transition-all flex items-center gap-2">
                    <i class="fab fa-google-drive"></i>
                    <span>התחבר לדרייב</span>
                </button>
                
                <button id="addAlbumBtn" onclick="openAlbumModal()" class="bg-gradient-to-r from-purple-500 to-blue-500 text-white px-6 py-2 rounded-full font-bold hover:shadow-lg transition-all flex items-center gap-2 hidden">
                    <i class="fas fa-plus"></i>
                    <span>אלבום חדש</span>
                </button>
                
                <div id="userInfo" class="hidden flex items-center gap-3">
                    <img id="userAvatar" src="" alt="" class="w-10 h-10 rounded-full border-2 border-white">
                    <span id="userName" class="text-white font-medium"></span>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-6 py-8">
        
        <!-- Welcome Section -->
        <div id="welcomeSection" class="text-center py-20">
            <div class="glass-card rounded-3xl p-12 max-w-2xl mx-auto shadow-2xl">
                <div class="w-24 h-24 bg-gradient-to-br from-purple-500 to-blue-500 rounded-full flex items-center justify-center text-white text-4xl mx-auto mb-6 shadow-lg">
                    <i class="fas fa-cloud-upload-alt"></i>
                </div>
                <h2 class="text-4xl font-bold mb-4 gradient-text">ברוכים הבאים ל-PhotoCloud</h2>
                <p class="text-gray-600 text-lg mb-8">
                    צור אלבומי תמונות מדהימים מתמונות ב-Google Drive שלך. הוסף כתוביות בענן לכל תמונה ושתף עם חברים ומשפחה.
                </p>
                <button onclick="handleAuthClick()" class="bg-gradient-to-r from-purple-500 to-blue-500 text-white px-8 py-4 rounded-full font-bold text-lg hover:shadow-xl transition-all transform hover:scale-105">
                    התחל עכשיו - התחבר לדרייב
                </button>
            </div>
        </div>

        <!-- Albums Grid -->
        <div id="albumsSection" class="hidden">
            <div class="flex justify-between items-center mb-8">
                <h2 class="text-3xl font-bold text-white">האלבומים שלי</h2>
                <div class="flex gap-2">
                    <button onclick="setView('grid')" class="glass p-3 rounded-lg text-white hover:bg-white/20 transition-all">
                        <i class="fas fa-th-large"></i>
                    </button>
                    <button onclick="setView('list')" class="glass p-3 rounded-lg text-white hover:bg-white/20 transition-all">
                        <i class="fas fa-list"></i>
                    </button>
                </div>
            </div>
            
            <div id="albumsGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Albums will be inserted here -->
            </div>
        </div>

        <!-- Single Album View -->
        <div id="singleAlbumView" class="hidden">
            <button onclick="backToAlbums()" class="mb-6 glass px-6 py-2 rounded-full text-white hover:bg-white/20 transition-all flex items-center gap-2">
                <i class="fas fa-arrow-right"></i>
                <span>חזרה לאלבומים</span>
            </button>
            
            <div class="glass-card rounded-3xl p-8 mb-8">
                <div class="flex justify-between items-start mb-6">
                    <div>
                        <h2 id="currentAlbumTitle" class="text-3xl font-bold gradient-text mb-2"></h2>
                        <p id="currentAlbumDesc" class="text-gray-600"></p>
                    </div>
                    <button onclick="openAddPhotoModal()" class="bg-gradient-to-r from-purple-500 to-blue-500 text-white px-6 py-3 rounded-full font-bold hover:shadow-lg transition-all flex items-center gap-2">
                        <i class="fas fa-plus"></i>
                        הוסף תמונות
                    </button>
                </div>
                
                <div id="photosGrid" class="photo-grid">
                    <!-- Photos will be inserted here -->
                </div>
                
                <div id="emptyPhotos" class="text-center py-16 hidden">
                    <div class="w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center text-gray-400 text-3xl mx-auto mb-4">
                        <i class="fas fa-image"></i>
                    </div>
                    <p class="text-gray-500">אין עדיין תמונות באלבום זה</p>
                    <button onclick="openAddPhotoModal()" class="mt-4 text-purple-600 font-medium hover:underline">
                        הוסף את התמונה הראשונה
                    </button>
                </div>
            </div>
        </div>

    </main>

    <!-- Create Album Modal -->
    <div id="albumModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
        <div class="glass-card rounded-3xl p-8 max-w-md w-full modal-enter">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold gradient-text">יצירת אלבום חדש</h3>
                <button onclick="closeAlbumModal()" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
            </div>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-gray-700 font-medium mb-2">שם האלבום</label>
                    <input type="text" id="albumName" class="floating-input w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-purple-500 focus:outline-none" placeholder="לדוגמה: טיול לפריז">
                </div>
                
                <div>
                    <label class="block text-gray-700 font-medium mb-2">תיאור</label>
                    <textarea id="albumDesc" class="floating-input w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-purple-500 focus:outline-none resize-none h-24" placeholder="תיאור קצר של האלבום..."></textarea>
                </div>
                
                <div>
                    <label class="block text-gray-700 font-medium mb-2">צבע אלבום</label>
                    <div class="flex gap-3">
                        <button onclick="selectColor('purple')" class="color-btn w-10 h-10 rounded-full bg-purple-500 ring-4 ring-purple-200 transition-all" data-color="purple"></button>
                        <button onclick="selectColor('blue')" class="color-btn w-10 h-10 rounded-full bg-blue-500 transition-all" data-color="blue"></button>
                        <button onclick="selectColor('green')" class="color-btn w-10 h-10 rounded-full bg-green-500 transition-all" data-color="green"></button>
                        <button onclick="selectColor('pink')" class="color-btn w-10 h-10 rounded-full bg-pink-500 transition-all" data-color="pink"></button>
                        <button onclick="selectColor('orange')" class="color-btn w-10 h-10 rounded-full bg-orange-500 transition-all" data-color="orange"></button>
                    </div>
                </div>
                
                <button onclick="createAlbum()" class="w-full bg-gradient-to-r from-purple-500 to-blue-500 text-white py-3 rounded-xl font-bold hover:shadow-lg transition-all mt-4">
                    צור אלבום
                </button>
            </div>
        </div>
    </div>

    <!-- Add Photo Modal -->
    <div id="photoModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
        <div class="glass-card rounded-3xl p-8 max-w-2xl w-full modal-enter max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold gradient-text">הוספת תמונות</h3>
                <button onclick="closePhotoModal()" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
            </div>
            
            <!-- Google Drive Files -->
            <div id="driveFilesSection" class="mb-6">
                <h4 class="font-medium text-gray-700 mb-3">בחר מהדרייב</h4>
                <div id="driveFilesList" class="grid grid-cols-2 md:grid-cols-3 gap-3 max-h-64 overflow-y-auto p-2">
                    <div class="text-center text-gray-500 py-8">
                        <div class="loading-spinner mx-auto mb-2"></div>
                        <p class="text-sm">טוען קבצים...</p>
                    </div>
                </div>
            </div>
            
            <div class="relative my-6">
                <div class="absolute inset-0 flex items-center">
                    <div class="w-full border-t border-gray-200"></div>
                </div>
                <div class="relative flex justify-center text-sm">
                    <span class="px-2 bg-white text-gray-500">או</span>
                </div>
            </div>
            
            <!-- Upload from Computer -->
            <div class="upload-zone rounded-2xl p-8 text-center cursor-pointer" onclick="document.getElementById('fileInput').click()">
                <input type="file" id="fileInput" multiple accept="image/*" class="hidden" onchange="handleFileSelect(event)">
                <i class="fas fa-cloud-upload-alt text-4xl text-purple-500 mb-3"></i>
                <p class="text-gray-600 font-medium">גרור תמונות לכאן או לחץ לבחירה</p>
                <p class="text-gray-400 text-sm mt-1">JPG, PNG, GIF עד 10MB</p>
            </div>
            
            <!-- Selected Photos Preview -->
            <div id="selectedPhotos" class="mt-6 space-y-3 hidden">
                <h4 class="font-medium text-gray-700">תמונות נבחרות</h4>
                <div id="photosPreview" class="space-y-3">
                    <!-- Preview items will be inserted here -->
                </div>
            </div>
            
            <div class="flex gap-3 mt-6">
                <button onclick="closePhotoModal()" class="flex-1 px-6 py-3 rounded-xl border-2 border-gray-200 text-gray-600 font-medium hover:bg-gray-50 transition-all">
                    ביטול
                </button>
                <button onclick="addPhotosToAlbum()" class="flex-1 bg-gradient-to-r from-purple-500 to-blue-500 text-white py-3 rounded-xl font-bold hover:shadow-lg transition-all">
                    הוסף לאלבום
                </button>
            </div>
        </div>
    </div>

    <!-- Edit Caption Modal -->
    <div id="captionModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
        <div class="glass-card rounded-3xl p-8 max-w-md w-full modal-enter">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold gradient-text">עריכת כתובית</h3>
                <button onclick="closeCaptionModal()" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
            </div>
            
            <div class="mb-6">
                <img id="captionPreviewImage" src="" alt="" class="w-full h-48 object-cover rounded-xl mb-4">
                <label class="block text-gray-700 font-medium mb-2">כתובית לתמונה</label>
                <input type="text" id="captionInput" class="floating-input w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-purple-500 focus:outline-none text-right" placeholder="הקלד כאן את הכתובית...">
                <p class="text-gray-400 text-sm mt-2">הכתובית תופיע בענן בתחתית התמונה</p>
            </div>
            
            <div class="flex gap-3">
                <button onclick="closeCaptionModal()" class="flex-1 px-6 py-3 rounded-xl border-2 border-gray-200 text-gray-600 font-medium hover:bg-gray-50 transition-all">
                    ביטול
                </button>
                <button onclick="saveCaption()" class="flex-1 bg-gradient-to-r from-purple-500 to-blue-500 text-white py-3 rounded-xl font-bold hover:shadow-lg transition-all">
                    שמור
                </button>
            </div>
        </div>
    </div>

    <script>
        // Configuration - REPLACE WITH YOUR GOOGLE API CREDENTIALS
        const CLIENT_ID = 'YOUR_CLIENT_ID.apps.googleusercontent.com';
        const API_KEY = 'YOUR_API_KEY';
        const DISCOVERY_DOCS = ["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"];
        const SCOPES = 'https://www.googleapis.com/auth/drive.readonly https://www.googleapis.com/auth/drive.file';
        
        // State
        let albums = JSON.parse(localStorage.getItem('photoAlbums')) || [];
        let currentAlbumId = null;
        let selectedColor = 'purple';
        let selectedPhotos = [];
        let currentEditingPhotoId = null;
        let isAuthenticated = false;
        
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            renderAlbums();
            initGoogleAPI();
        });
        
        // Google API Initialization
        function initGoogleAPI() {
            gapi.load('client:auth2', initClient);
        }
        
        function initClient() {
            gapi.client.init({
                apiKey: API_KEY,
                clientId: CLIENT_ID,
                discoveryDocs: DISCOVERY_DOCS,
                scope: SCOPES
            }).then(() => {
                gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus);
                updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get());
            }).catch(error => {
                console.error('Error initializing Google API:', error);
            });
        }
        
        function updateSigninStatus(isSignedIn) {
            isAuthenticated = isSignedIn;
            if (isSignedIn) {
                const user = gapi.auth2.getAuthInstance().currentUser.get();
                const profile = user.getBasicProfile();
                document.getElementById('userInfo').classList.remove('hidden');
                document.getElementById('userAvatar').src = profile.getImageUrl();
                document.getElementById('userName').textContent = profile.getGivenName();
                document.getElementById('connectDriveBtn').classList.add('hidden');
                document.getElementById('addAlbumBtn').classList.remove('hidden');
                document.getElementById('welcomeSection').classList.add('hidden');
                document.getElementById('albumsSection').classList.remove('hidden');
                loadDriveFiles();
            }
        }
        
        function handleAuthClick() {
            if (typeof gapi !== 'undefined' && gapi.auth2) {
                gapi.auth2.getAuthInstance().signIn();
            } else {
                // Demo mode for testing without Google API
                enableDemoMode();
            }
        }
        
        function handleSignoutClick() {
            gapi.auth2.getAuthInstance().signOut();
        }
        
        // Demo Mode (for testing without real Google API)
        function enableDemoMode() {
            isAuthenticated = true;
            document.getElementById('userInfo').classList.remove('hidden');
            document.getElementById('userAvatar').src = 'https://ui-avatars.com/api/?name=Demo+User&background=667eea&color=fff';
            document.getElementById('userName').textContent = 'משתמש הדגמה';
            document.getElementById('connectDriveBtn').classList.add('hidden');
            document.getElementById('addAlbumBtn').classList.remove('hidden');
            document.getElementById('welcomeSection').classList.add('hidden');
            document.getElementById('albumsSection').classList.remove('hidden');
            
            // Add demo files
            document.getElementById('driveFilesList').innerHTML = `
                <div onclick="selectDriveFile('demo1', 'https://picsum.photos/400/300?random=1')" class="cursor-pointer p-3 rounded-xl border-2 border-gray-200 hover:border-purple-500 transition-all text-center">
                    <img src="https://picsum.photos/400/300?random=1" class="w-full h-24 object-cover rounded-lg mb-2">
                    <p class="text-xs text-gray-600 truncate">תמונה 1.jpg</p>
                </div>
                <div onclick="selectDriveFile('demo2', 'https://picsum.photos/400/300?random=2')" class="cursor-pointer p-3 rounded-xl border-2 border-gray-200 hover:border-purple-500 transition-all text-center">
                    <img src="https://picsum.photos/400/300?random=2" class="w-full h-24 object-cover rounded-lg mb-2">
                    <p class="text-xs text-gray-600 truncate">תמונה 2.jpg</p>
                </div>
                <div onclick="selectDriveFile('demo3', 'https://picsum.photos/400/300?random=3')" class="cursor-pointer p-3 rounded-xl border-2 border-gray-200 hover:border-purple-500 transition-all text-center">
                    <img src="https://picsum.photos/400/300?random=3" class="w-full h-24 object-cover rounded-lg mb-2">
                    <p class="text-xs text-gray-600 truncate">תמונה 3.jpg</p>
                </div>
            `;
        }
        
        // Load files from Google Drive
        function loadDriveFiles() {
            if (!isAuthenticated) return;
            
            gapi.client.drive.files.list({
                'pageSize': 20,
                'fields': "nextPageToken, files(id, name, mimeType, thumbnailLink)",
                'q': "mimeType contains 'image/'"
            }).then(response => {
                const files = response.result.files;
                const container = document.getElementById('driveFilesList');
                
                if (files && files.length > 0) {
                    container.innerHTML = files.map(file => `
                        <div onclick="selectDriveFile('${file.id}', '${file.thumbnailLink || `https://drive.google.com/uc?export=view&id=${file.id}`}')" 
                             class="cursor-pointer p-3 rounded-xl border-2 border-gray-200 hover:border-purple-500 transition-all text-center group">
                            <img src="${file.thumbnailLink || `https://drive.google.com/uc?export=view&id=${file.id}`}" 
                                 class="w-full h-24 object-cover rounded-lg mb-2 group-hover:opacity-80 transition-all">
                            <p class="text-xs text-gray-600 truncate">${file.name}</p>
                        </div>
                    `).join('');
                } else {
                    container.innerHTML = '<p class="text-gray-500 text-center col-span-3">לא נמצאו תמונות בדרייב</p>';
                }
            }).catch(error => {
                console.error('Error loading drive files:', error);
                document.getElementById('driveFilesList').innerHTML = '<p class="text-red-500 text-center col-span-3">שגיאה בטעינת הקבצים</p>';
            });
        }
        
        // Album Management
        function openAlbumModal() {
            document.getElementById('albumModal').classList.remove('hidden');
            document.getElementById('albumName').value = '';
            document.getElementById('albumDesc').value = '';
        }
        
        function closeAlbumModal() {
            document.getElementById('albumModal').classList.add('hidden');
        }
        
        function selectColor(color) {
            selectedColor = color;
            document.querySelectorAll('.color-btn').forEach(btn => {
                btn.classList.remove('ring-4', 'ring-offset-2');
                if (btn.dataset.color === color) {
                    btn.classList.add('ring-4', 'ring-offset-2');
                }
            });
        }
        
        function createAlbum() {
            const name = document.getElementById('albumName').value;
            const desc = document.getElementById('albumDesc').value;
            
            if (!name) {
                alert('נא להזין שם לאלבום');
                return;
            }
            
            const album = {
                id: Date.now().toString(),
                name,
                description: desc,
                color: selectedColor,
                photos: [],
                createdAt: new Date().toISOString()
            };
            
            albums.push(album);
            saveAlbums();
            renderAlbums();
            closeAlbumModal();
        }
        
        function renderAlbums() {
            const grid = document.getElementById('albumsGrid');
            
            if (albums.length === 0) {
                grid.innerHTML = `
                    <div class="col-span-full text-center py-16">
                        <div class="w-24 h-24 bg-white/20 rounded-full flex items-center justify-center text-white text-4xl mx-auto mb-4">
                            <i class="fas fa-folder-open"></i>
                        </div>
                        <p class="text-white/80 text-lg">אין עדיין אלבומים</p>
                        <button onclick="openAlbumModal()" class="mt-4 text-white underline hover:no-underline">צור אלבום ראשון</button>
                    </div>
                `;
                return;
            }
            
            grid.innerHTML = albums.map(album => {
                const colorClasses = {
                    purple: 'from-purple-500 to-blue-500',
                    blue: 'from-blue-500 to-cyan-500',
                    green: 'from-green-500 to-emerald-500',
                    pink: 'from-pink-500 to-rose-500',
                    orange: 'from-orange-500 to-amber-500'
                };
                
                const gradient = colorClasses[album.color] || colorClasses.purple;
                const coverImage = album.photos[0]?.url || 'https://via.placeholder.com/400x300?text=אין+תמונות';
                
                return `
                    <div class="album-card glass-card rounded-3xl overflow-hidden cursor-pointer group" onclick="openAlbum('${album.id}')">
                        <div class="relative h-48 overflow-hidden">
                            <img src="${coverImage}" class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110">
                            <div class="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                            <div class="absolute top-4 right-4 w-10 h-10 rounded-full bg-gradient-to-br ${gradient} flex items-center justify-center text-white shadow-lg">
                                <i class="fas fa-images"></i>
                            </div>
                        </div>
                        <div class="p-6">
                            <h3 class="text-xl font-bold mb-2 text-gray-800">${album.name}</h3>
                            <p class="text-gray-500 text-sm mb-4 line-clamp-2">${album.description || 'אין תיאור'}</p>
                            <div class="flex justify-between items-center text-sm text-gray-400">
                                <span><i class="fas fa-image ml-1"></i> ${album.photos.length} תמונות</span>
                                <button onclick="event.stopPropagation(); deleteAlbum('${album.id}')" class="text-red-400 hover:text-red-600 transition-colors">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function deleteAlbum(id) {
            if (confirm('האם אתה בטוח שברצונך למחוק את האלבום?')) {
                albums = albums.filter(a => a.id !== id);
                saveAlbums();
                renderAlbums();
            }
        }
        
        function openAlbum(id) {
            currentAlbumId = id;
            const album = albums.find(a => a.id === id);
            
            document.getElementById('albumsSection').classList.add('hidden');
            document.getElementById('singleAlbumView').classList.remove('hidden');
            document.getElementById('currentAlbumTitle').textContent = album.name;
            document.getElementById('currentAlbumDesc').textContent = album.description || '';
            
            renderPhotos();
        }
        
        function backToAlbums() {
            document.getElementById('singleAlbumView').classList.add('hidden');
            document.getElementById('albumsSection').classList.remove('hidden');
            currentAlbumId = null;
        }
        
        // Photo Management
        function renderPhotos() {
            const album = albums.find(a => a.id === currentAlbumId);
            const grid = document.getElementById('photosGrid');
            const empty = document.getElementById('emptyPhotos');
            
            if (!album.photos.length) {
                grid.innerHTML = '';
                empty.classList.remove('hidden');
                return;
            }
            
            empty.classList.add('hidden');
            grid.innerHTML = album.photos.map(photo => `
                <div class="photo-container group relative bg-white rounded-2xl shadow-lg overflow-hidden">
                    <img src="${photo.url}" class="w-full h-64 object-cover" alt="${photo.caption || ''}">
                    
                    <div class="delete-btn" onclick="deletePhoto('${photo.id}')">
                        <i class="fas fa-times"></i>
                    </div>
                    
                    <div class="absolute inset-0 bg-gradient-to-t from-black/50 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                    
                    <button onclick="openCaptionModal('${photo.id}')" 
                            class="absolute top-4 left-4 bg-white/90 text-purple-600 w-10 h-10 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-all duration-300 hover:scale-110 shadow-lg">
                        <i class="fas fa-pen"></i>
                    </button>
                    
                    <div class="caption-bubble ${photo.caption ? 'visible' : ''}" id="caption-${photo.id}">
                        ${photo.caption || 'לחץ לעריכת כתובית'}
                    </div>
                </div>
            `).join('');
        }
        
        function deletePhoto(photoId) {
            if (confirm('האם למחוק את התמונה?')) {
                const album = albums.find(a => a.id === currentAlbumId);
                album.photos = album.photos.filter(p => p.id !== photoId);
                saveAlbums();
                renderPhotos();
            }
        }
        
        // Photo Upload Modal
        function openAddPhotoModal() {
            document.getElementById('photoModal').classList.remove('hidden');
            selectedPhotos = [];
            updateSelectedPhotosPreview();
            if (isAuthenticated) loadDriveFiles();
        }
        
        function closePhotoModal() {
            document.getElementById('photoModal').classList.add('hidden');
            selectedPhotos = [];
        }
        
        function selectDriveFile(id, url) {
            if (!selectedPhotos.find(p => p.id === id)) {
                selectedPhotos.push({ id, url, type: 'drive', file: null });
                updateSelectedPhotosPreview();
            }
        }
        
        function handleFileSelect(event) {
            const files = Array.from(event.target.files);
            files.forEach(file => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    selectedPhotos.push({
                        id: Date.now() + Math.random().toString(),
                        url: e.target.result,
                        type: 'local',
                        file: file
                    });
                    updateSelectedPhotosPreview();
                };
                reader.readAsDataURL(file);
            });
        }
        
        function updateSelectedPhotosPreview() {
            const container = document.getElementById('selectedPhotos');
            const preview = document.getElementById('photosPreview');
            
            if (selectedPhotos.length === 0) {
                container.classList.add('hidden');
                return;
            }
            
            container.classList.remove('hidden');
            preview.innerHTML = selectedPhotos.map((photo, index) => `
                <div class="flex items-center gap-4 p-3 bg-gray-50 rounded-xl">
                    <img src="${photo.url}" class="w-16 h-16 object-cover rounded-lg">
                    <div class="flex-1">
                        <p class="text-sm font-medium text-gray-700">${photo.type === 'drive' ? 'תמונה מדרייב' : photo.file.name}</p>
                    </div>
                    <button onclick="removeSelectedPhoto(${index})" class="text-red-400 hover:text-red-600 w-8 h-8 flex items-center justify-center rounded-full hover:bg-red-50 transition-all">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `).join('');
        }
        
        function removeSelectedPhoto(index) {
            selectedPhotos.splice(index, 1);
            updateSelectedPhotosPreview();
        }
        
        function addPhotosToAlbum() {
            if (selectedPhotos.length === 0) {
                alert('נא לבחור לפחות תמונה אחת');
                return;
            }
            
            const album = albums.find(a => a.id === currentAlbumId);
            selectedPhotos.forEach(photo => {
                album.photos.push({
                    id: Date.now().toString() + Math.random().toString(),
                    url: photo.url,
                    caption: '',
                    addedAt: new Date().toISOString()
                });
            });
            
            saveAlbums();
            renderPhotos();
            closePhotoModal();
        }
        
        // Caption Management
        function openCaptionModal(photoId) {
            currentEditingPhotoId = photoId;
            const album = albums.find(a => a.id === currentAlbumId);
            const photo = album.photos.find(p => p.id === photoId);
            
            document.getElementById('captionPreviewImage').src = photo.url;
            document.getElementById('captionInput').value = photo.caption || '';
            document.getElementById('captionModal').classList.remove('hidden');
        }
        
        function closeCaptionModal() {
            document.getElementById('captionModal').classList.add('hidden');
            currentEditingPhotoId = null;
        }
        
        function saveCaption() {
            const caption = document.getElementById('captionInput').value;
            const album = albums.find(a => a.id === currentAlbumId);
            const photo = album.photos.find(p => p.id === currentEditingPhotoId);
            
            photo.caption = caption;
            saveAlbums();
            renderPhotos();
            closeCaptionModal();
        }
        
        // Utilities
        function saveAlbums() {
            localStorage.setItem('photoAlbums', JSON.stringify(albums));
        }
        
        function setView(view) {
            const grid = document.getElementById('photosGrid');
            if (view === 'list') {
                grid.style.gridTemplateColumns = '1fr';
            } else {
                grid.style.gridTemplateColumns = 'repeat(auto-fill, minmax(300px, 1fr))';
            }
        }
        
        // Close modals on outside click
        window.onclick = function(event) {
            if (event.target.classList.contains('fixed')) {
                event.target.classList.add('hidden');
            }
        }
    </script>
</body>
</html>